---
title: "splatter_simulation_experiment_2"
author: "Hephaes"
date: "8/17/2020"
output: html_document
---
source("10X_main_approach3_splat.r")

# Loading/downloading all required packages and functions 
Assuming that 10X_main_approach3_splatter.R has been loaded to the current working directory, we load the required packages and functions by
```{r loadpackages, echo=TRUE, cache=TRUE}
library(tidyr)
library(stringr)
library(nabor)
library(aod)
library(DCATS)
library(dplyr)
library(clue)
library(gridExtra)
library(grid)
library(ggplot2)
library(lattice)
library(plotly)
library(svMisc)
library(gtools)
library(DCATS)
library(lme4)
library(scDC)
library(splatter)
library(scater)
library(Seurat)

source("10X_main_approach3_splat.r")
set.seed(1000)
```

# Generating and processing the simulated data
## Simulation 
The data is simulated by splatter. The user can control the number of cells, number of genes for each cell and the similarity between the cells (see the description of the function generateSimData for details). For example, 
```{r simulatedata, echo=TRUE,cache=TRUE}
simData <- generateSimData(batchCells = 10000, nGenes=3000, group.prob = c(1/3,1/3,1/3), de.prob = c(0.01,0.01,0.3))
simData[[1]][1:10,1:10]
simData[[2]][1:10]

```

## Experiments on clustering confusion by Seurat 
The gene-cell matrix simulated by splatter is treated by Seurat to produce (1) KNN graph and (2) clustering labels. (1) and (2) are further processed to generated the KNN-based similarity matrix, and (2) is compared with the original clustering labels generated to produce a confusion matrix of clustering 
```{r experiment_Seurat, echo=TRUE, cache=TRUE}
seuratobject <- SeuratTreat(simData[[1]])
ElbowPlot_inst <-  ElbowPlot(seuratobject)
ElbowPlot_inst
```

Next we consider different values of K and the resultant KNN-based similarity matrix 
```{r test_effects_of_K, echo=TRUE, cache=TRUE}
source("test_effects_of_K.r")
proseurat <-  FindNeighbors(seuratobject,k.param = 1000,dims=1:5)
proseurat <- FindClusters(proseurat,resolution=0.2)
mat <- KNN_transition(proseurat@graphs$RNA_snn,Idents(proseurat))
confmat <- table(simData[[2]],Idents(proseurat))
mat
confmat
```







